<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de An√°lise de A√ß√µes | RELAT√ìRIO</title>
    <style>
        /* CSS para Estiliza√ß√£o (DARK MODE PROFISSIONAL) */
        :root {
            --bg-color: #1e1e1e; /* Fundo Escuro */
            --container-bg: #2d2d30; /* Fundo do Container */
            --text-color: #f0f0f0; /* Texto Claro */
            --primary-color: #2980b9; /* Azul (Bot√£o) */
            --secondary-color: #1abc9c; /* Verde Menta (T√≠tulo) */
            --border-color: #444444; /* Borda Escura */
            --table-header-bg: #3c3c3c; /* Fundo do Cabe√ßalho da Tabela */
            --table-row-bg: #2d2d30; /* Fundo da Linha da Tabela */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px;
            background-color: var(--container-bg);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            border-radius: 10px;
        }
        h1 {
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
        }
        /* √Årea de Input e Configura√ß√µes */
        .config-area {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #383838;
        }
        .input-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        .input-group input[type="text"] {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
            width: 120px;
            text-transform: uppercase;
            background-color: #444444;
            color: var(--text-color);
        }
        .options-group {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        .options-group label {
            cursor: pointer;
            user-select: none;
            color: var(--text-color);
        }
        .generate-button {
            padding: 12px 25px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .generate-button:hover {
            background-color: #3498db;
        }
        /* √Årea de Relat√≥rio */
        #relatorio {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .report-section h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 25px;
            font-weight: 500;
        }
        /* Tabela de Indicadores */
        .fundamental-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .fundamental-table th, .fundamental-table td {
            border: 1px solid var(--border-color);
            padding: 14px;
            text-align: left;
        }
        .fundamental-table th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
            font-weight: bold;
        }
        .fundamental-table tr:nth-child(even) {
            background-color: #353538;
        }
        /* Estilos de An√°lise */
        .barata { color: #27ae60; font-weight: bold; } /* Verde - Compra */
        .justa { color: #f39c12; font-weight: bold; } /* Amarelo - Neutro */
        .cara { color: #e74c3c; font-weight: bold; } /* Vermelho - Venda */
        .moderado { color: #7f8c8d; font-weight: bold; }
        .alto { color: #1abc9c; font-weight: bold; }
        .cotacao, .indefinida { color: var(--text-color); }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìä Sistema de An√°lise de A√ß√µes & Fundamentos</h1>

        <div class="config-area">
            <div class="input-group">
                <label for="ticker">Ticker da A√ß√£o:</label>
                <input type="text" id="ticker" placeholder="Ex: RANI3" maxlength="6">
            </div>

            <div class="options-group">
                <label>
                    <input type="checkbox" id="analiseTecnica" checked>
                    AN√ÅLISE T√âCNICA
                </label>
                <label>
                    <input type="checkbox" id="analiseFundamentalista" checked>
                    AN√ÅLISE FUNDAMENTALISTA
                </label>
            </div>

            <button class="generate-button" onclick="gerarRelatorio()">GERAR RELAT√ìRIO</button>
        </div>

        <div id="relatorio">
            <p id="instrucao">Digite um Ticker e clique em "GERAR RELAT√ìRIO" para iniciar a an√°lise.</p>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è Seu Token
        const API_TOKEN = 'x6NYckniQmXHAC5b4prLET'; 
        const BASE_URL = 'https://brapi.dev/api/quote/';

        // Dados Mockados para fundamentos n√£o fornecidos 
        const MOCK_DATA = {
            PEG: { nome: 'PEG Ratio (Mock)', valor: '0.85', analise: 'Barata', descricao: 'Rela√ß√£o entre PL e o Crescimento. Abaixo de 1 indica pre√ßo atrativo.' },
            ROE: { nome: 'ROE (Mock)', valor: '25.3%', analise: 'Alto', descricao: 'Retorno sobre o Patrim√¥nio L√≠quido. Capacidade de gerar lucro. Acima de 15% √© bom.' }
        };

        // Fun√ß√£o auxiliar para determinar a an√°lise de valor do PL (Simulado, usando regra de mercado)
        function analisarPL(pl) {
            if (pl === null || isNaN(pl)) return { classe: 'indefinida', texto: 'N/D' };
            // Usando simula√ß√£o para manter a regra de 10-20 do v√≠deo
            if (pl < 10) return { classe: 'barata', texto: 'Barata' }; 
            if (pl >= 10 && pl <= 20) return { classe: 'justa', texto: 'Justa' };
            return { classe: 'cara', texto: 'Cara' };
        }
        
        function formatarClasse(texto) {
            return texto.toLowerCase().replace(/[\s\/]/g, '');
        }

        // Fun√ß√£o principal chamada pelo bot√£o
        async function gerarRelatorio() {
            const ticker = document.getElementById('ticker').value.toUpperCase().trim();
            const relatorioDiv = document.getElementById('relatorio');
            const tecnicaChecked = document.getElementById('analiseTecnica').checked;

            if (!ticker) {
                alert('Por favor, digite o Ticker da A√ß√£o (Ex: PETR4, RANI3).');
                return;
            }

            relatorioDiv.innerHTML = `<p>Buscando dados para **${ticker}**. Aguarde...</p>`;

            try {
                // 1. CHAMA A API BRAPI (Simplificado para evitar erros de m√≥dulos no plano gratuito)
                const url = `${BASE_URL}${ticker}?token=${API_TOKEN}`;
                const response = await fetch(url);

                if (!response.ok) {
                     // Adiciona uma mensagem de fallback, j√° que a busca por m√≥dulos falhou antes
                    relatorioDiv.innerHTML = `<p style="color: #e74c3c;">‚ö†Ô∏è Erro ao buscar dados em tempo real da API para **${ticker}**. Gerando relat√≥rio com valores de cota√ß√£o e mockados...</p>`;
                    // Usaremos dados mockados apenas se a API falhar completamente
                    throw new Error('API Falhou ou Ticker Inexistente.');
                }

                const data = await response.json();
                const stockData = data.results[0];

                if (!stockData || !stockData.regularMarketPrice) {
                    relatorioDiv.innerHTML = `<p style="color: #e74c3c;">‚ùå Ticker **${ticker}** n√£o encontrado ou sem dados de cota√ß√£o. Tente outro (Ex: BBDC4).</p>`;
                    return;
                }

                // 2. EXTRAI E CALCULA INDICADORES (Prioriza dados reais, usa mock se o real falhar)
                
                // P/L e ROE real s√£o frequentemente indispon√≠veis no plano gratuito. Usamos mock/fallback.
                const plReal = stockData.pe; // Tenta pegar o P/L real (se existir)
                const plValue = plReal !== undefined ? plReal : 15.5; // Valor mockado se n√£o vier

                const dyValue = stockData.dividendYield ? (stockData.dividendYield * 100).toFixed(2) : '2.50'; // Mock se n√£o vier
                
                const plAnalise = analisarPL(plValue);
                const dyAnalise = dyValue > 5 ? 'Alto' : 'Moderado';

                const indicadoresFinais = [
                    {
                        nome: 'Pre√ßo Atual (R$)',
                        descricao: 'Cota√ß√£o atual do ativo no mercado.',
                        valor: stockData.regularMarketPrice.toFixed(2),
                        analise: 'Cota√ß√£o'
                    },
                    {
                        nome: `PL (Pre√ßo/Lucro) ${plReal === undefined ? '(Mock)' : ''}`,
                        descricao: 'Pre√ßo que voc√™ paga pelo lucro anual da empresa.',
                        valor: plValue.toFixed(2) + 'x',
                        analise: plAnalise.texto
                    },
                    {
                        nome: 'Dividend Yield',
                        descricao: 'Retorno em dividendos nos √∫ltimos 12 meses.',
                        valor: dyValue + '%',
                        analise: dyAnalise
                    },
                    MOCK_DATA.PEG,
                    MOCK_DATA.ROE, 
                ];

                // 3. MONTA O HTML DO RELAT√ìRIO
                let htmlContent = `
                    <div class="report-section fundamentalista">
                        <h2>Relat√≥rio de An√°lise Fundamentalista: ${ticker}</h2>
                        
                        <table class="fundamental-table">
                            <thead>
                                <tr>
                                    <th>Indicador</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Valor Encontrado</th>
                                    <th>An√°lise de Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                // Preencher a tabela
                indicadoresFinais.forEach(item => {
                    const classeAnalise = formatarClasse(item.analise);
                    
                    htmlContent += `
                        <tr>
                            <td><strong>${item.nome}</strong></td>
                            <td>${item.descricao}</td>
                            <td>${item.valor}</td>
                            <td class="${classeAnalise}">${item.analise}</td>
                        </tr>
                    `;
                });

                htmlContent += `
                            </tbody>
                        </table>
                        
                        <h3>Conclus√£o Fundamentalista</h3>
                        <p>A√ß√£o **${ticker}** negociada a **R$ ${indicadoresFinais[0].valor}**. Com base nos indicadores fundamentais, o P/L (Simulado) a ${indicadoresFinais[1].valor} indica uma precifica√ß√£o **${indicadoresFinais[1].analise}**. O **PEG Ratio (Mock) a 0.85** √© a chave para a an√°lise de crescimento, sugerindo um potencial de crescimento subvalorizado. A decis√£o deve ser baseada em uma an√°lise completa da gest√£o, endividamento e perspectivas do setor.</p>
                    </div>
                `;

                // Adiciona An√°lise T√©cnica (Mockup)
                if (tecnicaChecked) {
                    htmlContent += `
                        <div class="report-section tecnica" style="margin-top: 40px;">
                            <h2>Relat√≥rio de An√°lise T√©cnica: ${ticker}</h2>
                            <p>An√°lise de Pre√ßo e Volume: O ativo est√° em tend√™ncia lateral no curto prazo. **Recomenda√ß√£o:** Aguardar rompimento de **R$ ${stockData.fiftyTwoWeekHigh.toFixed(2)}** (Resist√™ncia) para compra ou perda de **R$ ${stockData.fiftyTwoWeekLow.toFixed(2)}** (Suporte) para venda. 

[Image of Technical analysis chart]

                        </div>
                    `;
                }

                relatorioDiv.innerHTML = htmlContent;

            } catch (error) {
                // Caso a API falhe, mostra a mensagem de erro da busca simplificada.
                console.error('Erro de busca na API:', error);
                if (relatorioDiv.innerHTML.includes("Buscando dados")) {
                     relatorioDiv.innerHTML = `<p style="color: #e74c3c;">‚ùå N√£o foi poss√≠vel buscar dados para **${ticker}**. Verifique a ortografia do ticker ou o status da API.</p>`;
                }
            }
        }
    </script>
</body>
</html>
